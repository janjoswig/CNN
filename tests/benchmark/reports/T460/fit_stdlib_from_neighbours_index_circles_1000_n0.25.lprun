Timer unit: 1e-06 s

Total time: 0.083877 s
File: /home/janjoswig/CNN/tests/benchmark/snippets/fits.py
Function: fit_stdlib_from_neighbours_index at line 154

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   154                                           def fit_stdlib_from_neighbours_index(
   155                                                   cnn_cutoff: int,
   156                                                   neighbours: List[Set[int]]) -> List:
   157                                               """Worker function variant applying the CNN algorithm.
   158                                           
   159                                               Assigns labels to points starting from pre-computed neighbour list.
   160                                               Uses Python standard library only.  Uses builtin function `index`
   161                                               to find unassigned initial cluster points, which is expected to be
   162                                               fast when done seldom (compare to fit_stdlib_from_neighbours_loop).
   163                                           
   164                                               Args:
   165                                                   cnn_cutoff: Similarity criterion
   166                                                   neighbours: List of length #points containing sets of
   167                                                       neighbouring point indices
   168                                           
   169                                               Returns:
   170                                                   Labels
   171                                               """
   172                                           
   173                                               # Initialise labels
   174         1        267.0    267.0      0.3      labels = [0 for _ in range(len(neighbours))]
   175                                           
   176                                               # Track assigment
   177         1        245.0    245.0      0.3      include = [True for _ in range(len(neighbours))]
   178                                           
   179                                               # Start with first cluster (0 = noise)
   180         1          2.0      2.0      0.0      current = 1
   181                                           
   182                                               # Initialise queue of points to scan
   183         1          9.0      9.0      0.0      queue = deque()
   184                                           
   185                                               while True:
   186         3          3.0      1.0      0.0          try:
   187         3         27.0      9.0      0.0              point = include.index(True)  # Pick starting point
   188         1          2.0      2.0      0.0          except ValueError:               # All points assigned
   189         1          2.0      2.0      0.0              break
   190         2          7.0      3.5      0.0          labels[point] = current          # Assign cluster label
   191         2          2.0      1.0      0.0          include[point] = False           # Mark point as included
   192         2          5.0      2.5      0.0          queue.append(point)              # Add point to queue
   193                                           
   194      1002        829.0      0.8      1.0          while queue:
   195      1000       1147.0      1.1      1.4              point = queue.popleft()      # FIFO
   196                                           
   197                                                       # Loop over neighbouring points
   198      1000        996.0      1.0      1.2              neigh = neighbours[point]
   199     28448      24072.0      0.8     28.7              for member in neigh:
   200     27448      26930.0      1.0     32.1                  if not include[member]:
   201                                                               # Point already assigned
   202     26450      21014.0      0.8     25.1                      continue
   203                                           
   204                                                           # conditional growth
   205       998       5298.0      5.3      6.3                  if len(neigh.intersection(neighbours[member])) >= cnn_cutoff:
   206       998       1097.0      1.1      1.3                      labels[member] = current
   207       998        882.0      0.9      1.1                      include[member] = False
   208       998       1037.0      1.0      1.2                      queue.append(member)
   209                                           
   210         2          3.0      1.5      0.0          current += 1
   211                                           
   212         1          1.0      1.0      0.0      return labels