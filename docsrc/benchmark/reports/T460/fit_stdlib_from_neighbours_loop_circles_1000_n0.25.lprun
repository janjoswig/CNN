Timer unit: 1e-06 s

Total time: 0.084515 s
File: /home/janjoswig/CNN/tests/benchmark/snippets/fits.py
Function: fit_stdlib_from_neighbours_loop at line 215

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   215                                           def fit_stdlib_from_neighbours_loop(
   216                                                   cnn_cutoff: int,
   217                                                   neighbours: List[Set[int]]) -> List:
   218                                               """Worker function variant applying the CNN algorithm.
   219                                           
   220                                               Assigns labels to points starting from pre-computed neighbour list.
   221                                               Uses Python standard library only.  Minor design difference to
   222                                               `fit_stdlib_from_neighbours_index` in looping over all points
   223                                               instead of checking for `include.index(True)`. Expected to be faster
   224                                               when many cluster initialisations are done. Also, checking queue
   225                                               at the end of the inner loop instead of in the begenning (no
   226                                               performance difference expected, but unnecessary adding of initial
   227                                               points to queue is avoided).
   228                                           
   229                                               Args:
   230                                                   cnn_cutoff: Similarity criterion
   231                                                   neighbours: List of length #points containing sets of
   232                                                       neighbouring point indices
   233                                           
   234                                               Returns:
   235                                                   Labels
   236                                               """
   237                                           
   238         1          3.0      3.0      0.0      len_ = len(neighbours)
   239                                           
   240                                               # Initialise labels
   241         1        112.0    112.0      0.1      labels = [0 for _ in range(len_)]
   242                                           
   243                                               # Track assigment
   244         1        107.0    107.0      0.1      include = [True for _ in range(len_)]
   245                                           
   246                                               # Start with first cluster (0 = noise)
   247         1          1.0      1.0      0.0      current = 1
   248                                           
   249                                               # Initialise queue of points to scan
   250         1          1.0      1.0      0.0      queue = deque()
   251                                           
   252      1001        700.0      0.7      0.8      for point in range(len_):
   253      1000        759.0      0.8      0.9          if not include[point]:
   254                                                       # Point already assigned
   255       998        637.0      0.6      0.8              continue
   256         2          2.0      1.0      0.0          labels[point] = current          # Assign cluster label
   257         2          0.0      0.0      0.0          include[point] = False           # Mark point as included
   258                                           
   259                                                   while True:
   260                                                       # Loop over neighbouring points
   261      1000       1011.0      1.0      1.2              neigh = neighbours[point]
   262     28448      24500.0      0.9     29.0              for member in neigh:
   263     27448      26079.0      1.0     30.9                  if not include[member]:
   264                                                               # Point already assigned
   265     26450      21211.0      0.8     25.1                      continue
   266                                           
   267                                                           # conditional growth
   268       998       4561.0      4.6      5.4                  if len(neigh.intersection(neighbours[member])) >= cnn_cutoff:
   269       998       1019.0      1.0      1.2                      labels[member] = current
   270       998        857.0      0.9      1.0                      include[member] = False
   271       998        990.0      1.0      1.2                      queue.append(member)
   272                                           
   273      1000        855.0      0.9      1.0              if not queue:
   274         2          2.0      1.0      0.0                  break
   275       998       1105.0      1.1      1.3              point = queue.popleft()  # FIFO
   276                                           
   277         2          2.0      1.0      0.0          current += 1
   278                                           
   279         1          1.0      1.0      0.0      return labels