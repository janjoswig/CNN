
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Benchmarking &#8212; cnnclustering  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Benchmarking">
<h1>Benchmarking<a class="headerlink" href="#Benchmarking" title="Permalink to this headline">¶</a></h1>
<p>Notebook to organise benchmarks of different implementations of the common-nearest-neighbour clustering and other cluster algorithms:</p>
<ul class="simple">
<li><p>DBSCAN (<code class="docutils literal notranslate"><span class="pre">sklearn.cluster.DBSCAN</span></code>)</p></li>
<li><p>HDBSCAN ()</p></li>
<li><p>OPTICS (<code class="docutils literal notranslate"><span class="pre">sklearn.cluster.OPTICS</span></code>)</p></li>
<li><p>Density peaks ()</p></li>
<li><p>Jarvis-Patrick ()</p></li>
<li><p>Common-nearest-neighbours (<code class="docutils literal notranslate"><span class="pre">cnnclustering.cnn</span></code>)</p></li>
<li><p>Common-nearest-neighbours (<code class="docutils literal notranslate"><span class="pre">sklearn_extra.cluster.CommonNNClustering</span></code>)</p></li>
</ul>
<h1><p>Table of Contents</p>
</h1><div class="toc"><ul class="toc-item"><li><p>1  Pre-requirements</p>
</li><li><p>2  Version info</p>
</li><li><p>3  Helper function definitions</p>
<ul class="toc-item"><li><p>3.1  Plots</p>
</li><li><p>3.2  Test data set generation</p>
</li><li><p>3.3  Benchmark organisation</p>
</li><li><p>3.4  Profiling</p>
</li></ul></li><li><p>4  Consitency check</p>
<ul class="toc-item"><li><p>4.1  scikit-learn DBSCAN</p>
</li><li><p>4.2  scikit-learn-extra CommonNNClustering</p>
</li><li><p>4.3  cnnclustering CNN from points on-the-fly</p>
</li><li><p>4.4  cnnclustering CNN from points bulk</p>
</li><li><p>4.5  cnnclustering CNN from distances on-the-fly</p>
</li><li><p>4.6  cnnclustering CNN from distances bulk</p>
</li><li><p>4.7  scikit-learn OPTICS (DBSCAN)</p>
</li><li><p>4.8  scikit-learn OPTICS (XI)</p>
</li></ul></li><li><p>5  Timings</p>
<ul class="toc-item"><li><p>5.1  Blobs set</p>
</li></ul></li><li><p>6  Fit variants</p>
<ul class="toc-item"><li><p>6.1  From neighbours</p>
<ul class="toc-item"><li><p>6.1.1  From list of sets</p>
<ul class="toc-item"><li><p>6.1.1.1  Baseline</p>
</li><li><p>6.1.1.2  Stdlib index</p>
</li><li><p>6.1.1.3  Stdlib cython</p>
</li></ul></li><li><p>6.1.2  From numpy.array</p>
</li><li><p>6.1.3  Check in CNN class context</p>
</li></ul></li><li><p>6.2  From density graph</p>
<ul class="toc-item"><li><p>6.2.1  From SparsegraphArray</p>
</li></ul></li></ul></li></ul></div><div class="section" id="Pre-requirements">
<h2>Pre-requirements<a class="headerlink" href="#Pre-requirements" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="o">%</span><span class="k">matplotlib</span> widget
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">hdbscan</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">import</span> <span class="nn">sklearn_extra</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">cluster</span> <span class="k">as</span> <span class="n">skcluster</span>
<span class="kn">from</span> <span class="nn">sklearn_extra</span> <span class="kn">import</span> <span class="n">cluster</span> <span class="k">as</span> <span class="n">skextracluster</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="kn">import</span> <span class="nn">cnnclustering</span>
<span class="kn">from</span> <span class="nn">cnnclustering</span> <span class="kn">import</span> <span class="n">_cfits</span>  <span class="c1"># Cythonised fit implementation</span>
<span class="kn">from</span> <span class="nn">cnnclustering</span> <span class="kn">import</span> <span class="n">_fits</span>   <span class="c1"># Python fit implementation</span>
<span class="kn">from</span> <span class="nn">cnnclustering</span> <span class="kn">import</span> <span class="n">cnn</span>

<span class="c1"># Jupyter extensions</span>
<span class="o">%</span><span class="k">load_ext</span> Cython
<span class="o">%</span><span class="k">load_ext</span> line_profiler
<span class="o">%</span><span class="k">load_ext</span> memory_profiler
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Matplotlib configuration</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">rcParamsDefault</span><span class="p">)</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rc_file</span><span class="p">(</span><span class="s2">&quot;../tutorial/matplotlibrc&quot;</span><span class="p">,</span> <span class="n">use_default_template</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Jupyter notebook configuration</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;style&gt;.container { width:85% !important; }&lt;/style&gt;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>.container { width:85% !important; }</style></div>
</div>
</div>
<div class="section" id="Version-info">
<h2>Version info<a class="headerlink" href="#Version-info" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Python&#39;</span><span class="si">:</span><span class="s2">&gt;20</span><span class="si">}</span><span class="s2"> :  &quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">splitlines</span><span class="p">())</span>

<span class="n">modules</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;scikit-learn&#39;</span><span class="p">,</span> <span class="n">sklearn</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;scikit-learn-extra&#39;</span><span class="p">,</span> <span class="n">sklearn_extra</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;cnnclustering&#39;</span><span class="p">,</span> <span class="n">cnnclustering</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;hdbscan&#39;</span><span class="p">,</span> <span class="n">hdbscan</span><span class="p">),</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">alias</span><span class="si">:</span><span class="s2">&gt;20</span><span class="si">}</span><span class="s2"> :  &quot;</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">alias</span><span class="si">:</span><span class="s2">&gt;20</span><span class="si">}</span><span class="s2"> :  &quot;</span><span class="p">,</span> <span class="s2">&quot;no version info&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
              Python :   3.8.3 (default, May 15 2020, 15:24:35)  [GCC 8.3.0]
        scikit-learn :   0.24.dev0
  scikit-learn-extra :   0.1.0b2
       cnnclustering :   0.3.9
             hdbscan :   no version info
</pre></div></div>
</div>
</div>
<div class="section" id="Helper-function-definitions">
<h2>Helper function definitions<a class="headerlink" href="#Helper-function-definitions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Plots">
<h3>Plots<a class="headerlink" href="#Plots" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Axis property defaults for the plots</span>
<span class="n">ax_props</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;xlim&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
    <span class="s2">&quot;ylim&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
    <span class="s2">&quot;xticks&quot;</span><span class="p">:</span> <span class="p">(),</span>
    <span class="s2">&quot;yticks&quot;</span><span class="p">:</span> <span class="p">(),</span>
    <span class="s2">&quot;aspect&quot;</span><span class="p">:</span> <span class="s2">&quot;equal&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Take a data set and cluster labels to make a basic 2D dot plot</span>

<span class="sd">    Args:</span>
<span class="sd">        data: Numpy `numpy.ndarray` of shape (#points, 2) with x, y</span>
<span class="sd">            coordinates of points in 2D</span>
<span class="sd">        labels: Numpy `numpy.ndarray` of shape (#points,) and</span>
<span class="sd">            `dtype = int` holding cluster label assignments for all</span>
<span class="sd">            points.  If `None`, will plot the data set without</span>
<span class="sd">            point colouring by label.</span>
<span class="sd">        ax: Matplotlib `matplotlib.axes.SubplotBase` instance to</span>
<span class="sd">            attach the plot to.  If `None`, wil create a new instance.</span>
<span class="sd">        noise: Integer label used to mark point as noise (no cluster</span>
<span class="sd">            assignment; Usually 0 or -1).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="o">*</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">noise</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
            <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">cluster_number</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">noise</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">cluster_number</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
                <span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
        <span class="s2">&quot;xticks&quot;</span><span class="p">:</span> <span class="p">(),</span>
        <span class="s2">&quot;yticks&quot;</span><span class="p">:</span> <span class="p">(),</span>
        <span class="s2">&quot;xticklabels&quot;</span><span class="p">:</span> <span class="p">(),</span>
        <span class="s2">&quot;yticklabels&quot;</span><span class="p">:</span> <span class="p">(),</span>
        <span class="s2">&quot;aspect&quot;</span><span class="p">:</span> <span class="s2">&quot;equal&quot;</span>
        <span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Test-data-set-generation">
<h3>Test data set generation<a class="headerlink" href="#Test-data-set-generation" title="Permalink to this headline">¶</a></h3>
<p>Data set generation functions should be generally designed in such a way that they expect exactly one argument <em>n</em> and return a 2D data set of <em>n</em> sample points. A <code class="docutils literal notranslate"><span class="pre">label</span></code> attribute can be optionally added to the function object for identification.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Global seed for data set generation functions</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># circles</span>
<span class="k">def</span> <span class="nf">gen_circles</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">circles</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_circles</span><span class="p">(</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
        <span class="n">factor</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">noise</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">circles</span><span class="p">)</span>

<span class="n">gen_circles</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;circles&quot;</span>

<span class="c1"># blobs</span>
<span class="k">def</span> <span class="nf">gen_blobs</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">blobs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_blobs</span><span class="p">(</span>
        <span class="n">centers</span><span class="o">=</span><span class="p">[[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]],</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">blobs</span><span class="p">)</span>

<span class="n">gen_blobs</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;blobs&quot;</span>

<span class="c1"># moons</span>
<span class="k">def</span> <span class="nf">gen_moons</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">moons</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_moons</span><span class="p">(</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
        <span class="n">noise</span><span class="o">=.</span><span class="mi">05</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">moons</span><span class="p">)</span>

<span class="n">gen_moons</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;moons&quot;</span>

<span class="k">def</span> <span class="nf">gen_no_structure</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">no_structure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">no_structure</span><span class="p">)</span>

<span class="n">gen_no_structure</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>

<span class="k">def</span> <span class="nf">gen_aniso</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_blobs</span><span class="p">(</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">170</span>
        <span class="p">)</span>

    <span class="n">transformation</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]]</span>
    <span class="n">aniso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">aniso</span><span class="p">)</span>

<span class="n">gen_aniso</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;aniso&quot;</span>

<span class="k">def</span> <span class="nf">gen_varied</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">varied</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_blobs</span><span class="p">(</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
        <span class="n">cluster_std</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">170</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">varied</span><span class="p">)</span>

<span class="n">gen_varied</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;varied&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Benchmark-organisation">
<h3>Benchmark organisation<a class="headerlink" href="#Benchmark-organisation" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">DS</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Benchmark class to represent a data set</span>

<span class="sd">    Initialise a `DS` instance with a data set generation function.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       points: A (2D) sample data set</span>
<span class="sd">       prepare_neighbourhoods: Pre-compute neighbourhoods</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">gen_fxn</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">gen_fxn_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gen_fxn_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gen_fxn</span> <span class="o">=</span> <span class="n">gen_fxn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>

        <span class="k">if</span> <span class="n">gen_fxn_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gen_fxn_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">gen_fxn_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gen_fxn_args</span> <span class="o">=</span> <span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="o">*</span><span class="n">gen_fxn_args</span><span class="p">,</span> <span class="o">**</span><span class="n">gen_fxn_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Pre-computed neighbourhoods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="kc">None</span>               <span class="c1"># Neighbourhood computation radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeits</span> <span class="o">=</span> <span class="p">{}</span>           <span class="c1"># Timing results</span>

    <span class="k">def</span> <span class="nf">prepare_neighbourhoods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">numpy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pre-compute neighbourhoods at a given readius `r`</span>

<span class="sd">        Uses `sklearn.neighbors.NearestNeighbors`.</span>

<span class="sd">        Args:</span>
<span class="sd">            numpy: If `True`, returns a `numpy.ndarray` of shape</span>
<span class="sd">            (#points,) containing the neighbours of each points as</span>
<span class="sd">            `numpy.ndarray` of shape (#neighbours,).  If `False`,</span>
<span class="sd">            returns a `list` of `sets` instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">neighbour_model</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="n">neighbours</span> <span class="o">=</span> <span class="n">neighbour_model</span><span class="o">.</span><span class="n">radius_neighbors</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">return_distance</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>

        <span class="c1"># Remove self-counting</span>
        <span class="n">neighbours</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">neighbours</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">neighbours</span><span class="p">):</span>
            <span class="n">s</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numpy</span><span class="p">:</span>
            <span class="n">neighbours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">neighbours</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span> <span class="o">=</span> <span class="n">neighbours</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="n">r</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">desc_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_fxn</span><span class="o">.</span><span class="n">label</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">desc_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_fxn</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="c1"># p: from points</span>
        <span class="c1"># d: from distances</span>
        <span class="c1"># n: from neighbours</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">neighbourhoods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">desc_from</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">desc_from</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;d&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">desc_from</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;p&quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">desc_gen</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">desc_from</span><span class="si">}</span><span class="s2">&quot;</span>


    <span class="k">def</span> <span class="nf">ratios</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show relative performance of runs based on `timeits` dict&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeits</span><span class="p">[</span><span class="n">base</span><span class="p">]</span><span class="o">.</span><span class="n">average</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">average</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeits</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">([</span>
            <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">average</span> <span class="o">/</span> <span class="n">base</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeits</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Benchmark fixture 1</span>
<span class="k">def</span> <span class="nf">prepare_neighbours</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">gen_fxn</span><span class="p">,</span> <span class="n">numpy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Provide pre-computed neighbourhoods</span>

<span class="sd">    Uses `sklearn.neighbors.NearestNeighbors`. Removes self-counting</span>
<span class="sd">    of points as neighbours of themselves.</span>

<span class="sd">    Args:</span>
<span class="sd">       n: Number of data points</span>
<span class="sd">       r: Radius</span>
<span class="sd">       gen_fxn: Function that accepts one parameter `n` and returns</span>
<span class="sd">           a data set with `n` points, for which neighbourhoods will</span>
<span class="sd">           be computed.</span>
<span class="sd">       numpy: If `True`, provide neighbourhoods as 1D `numpy.array` of 1D</span>
<span class="sd">           `numpy.array`s.  If `False`, convert to `list` of `set`s.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">neighbour_model</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">neighbours</span> <span class="o">=</span> <span class="n">neighbour_model</span><span class="o">.</span><span class="n">radius_neighbors</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">return_distance</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">neighbours</span> <span class="o">=</span> <span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">neighbours</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">neighbours</span><span class="p">):</span>
        <span class="c1"># Remove self-counting</span>
        <span class="n">s</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">numpy</span><span class="p">:</span>
        <span class="c1"># Reconvert to numpy.array</span>
        <span class="n">neighbours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">neighbours</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">neighbours</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Profiling">
<h3>Profiling<a class="headerlink" href="#Profiling" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">profile_fxn</span><span class="p">(</span>
        <span class="n">f</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">t</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function profiling procedure</span>

<span class="sd">    Runs %lprun and %timeit line magic on a globally defined function</span>
<span class="sd">    `fxn`.  Function args and kwargs need to be defined globally as</span>
<span class="sd">    well.  This is necessary, because (at least lprun) line magic does</span>
<span class="sd">    not seem to work well with local variables, e.g. the following</span>
<span class="sd">    alternative did not work (raises `NameError`):</span>

<span class="sd">       def profile_fxn(fxn, *args, **kwargs):</span>
<span class="sd">           %lprun -f fxn fxn(*args, **kwargs)</span>
<span class="sd">           ...</span>

<span class="sd">    This function expects a :obj:`DS` object, providing a dataset and</span>
<span class="sd">    pre-calculated values if necessary.  Report details are deduced from</span>
<span class="sd">    this object.  Timings are saved to the object.</span>

<span class="sd">    Args:</span>
<span class="sd">       f (:obj:`func`): Function to profile.</span>
<span class="sd">       ds (:obj:`DS`): Data set object.</span>
<span class="sd">       report_dir (str): Output directory file path.</span>
<span class="sd">       *args: Arguments passed to `f`</span>

<span class="sd">    Keyword args:</span>
<span class="sd">       t (bool): If `True`, time function call with timeit line magic</span>
<span class="sd">       l (bool): If `True`, line profile function call with lpro line magic</span>
<span class="sd">       label (optional, str): Label to identify the run.  If `None`,</span>
<span class="sd">          `fxn.__name__` is used.</span>
<span class="sd">       validate (bool): If True, execute function call once to evaluate</span>
<span class="sd">          the result before the benchmark</span>

<span class="sd">       **kwargs: Keyword arguments passed to `f`.</span>

<span class="sd">    Returns:</span>
<span class="sd">       None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">global</span> <span class="n">fxn</span>
    <span class="k">global</span> <span class="n">fxn_args</span>
    <span class="k">global</span> <span class="n">fxn_kwargs</span>

    <span class="n">fxn</span> <span class="o">=</span> <span class="n">f</span>
    <span class="n">fxn_args</span> <span class="o">=</span> <span class="n">args</span>
    <span class="n">fxn_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>

    <span class="k">if</span> <span class="n">validate</span><span class="p">:</span>
        <span class="c1"># Validate function result (experimental)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">fxn</span><span class="p">(</span><span class="o">*</span><span class="n">fxn_args</span><span class="p">,</span> <span class="o">**</span><span class="n">fxn_kwargs</span><span class="p">)</span>

        <span class="c1"># Convert result if not labels array</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1"># Convert result if from original implementation (baseline)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">baseline_to_labels</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">noise</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">frequencies</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">frequencies</span><span class="p">:</span>
                <span class="n">noise</span> <span class="o">=</span> <span class="n">frequencies</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">largest</span> <span class="o">=</span> <span class="n">frequencies</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">frequencies</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">clusters</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of labels:    </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Noise:               </span><span class="si">{</span><span class="n">noise</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Largest:             </span><span class="si">{</span><span class="n">largest</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Clusters:            </span><span class="si">{</span><span class="n">clusters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Profile</span>
    <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
        <span class="o">%</span><span class="k">lprun</span> -T {report_dir}/{fxn.__name__}_{ds.__str__()}.lprun -f fxn fxn(*fxn_args, **fxn_kwargs)
    <span class="k">if</span> <span class="n">t</span><span class="p">:</span>
        <span class="n">o</span> <span class="o">=</span> <span class="o">%</span><span class="k">timeit</span> -q -o fxn(*fxn_args, **fxn_kwargs)

        <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">fxn</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">timeits</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">label</span><span class="p">:</span> <span class="n">o</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">baseline_to_labels</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert result from original implementation (baseline)&quot;&quot;&quot;</span>

    <span class="n">len_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)]</span>
    <span class="n">result_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">len_</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">:</span>
            <span class="n">result_</span><span class="p">[</span><span class="n">member</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result_</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">sub_ds_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">ds</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;DS_ATTR:&quot;</span><span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">time_runs</span><span class="p">(</span>
        <span class="n">signatures</span><span class="p">,</span> <span class="n">gen_fxn</span><span class="p">,</span>
        <span class="n">timings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">timings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">timings</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">DS</span><span class="p">(</span><span class="n">gen_fxn</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">KWARGS</span> <span class="ow">in</span> <span class="n">signatures</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">sub_ds_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="n">KWARGS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">KWARGS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="p">{}))</span>

            <span class="n">profile_fxn</span><span class="p">(</span>
                <span class="n">f</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="s2">&quot;/dev/null&quot;</span><span class="p">,</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>           <span class="c1"># function args</span>
                <span class="n">l</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># function kwargs</span>
                <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>

        <span class="n">timings</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">timeits</span>

        <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">ratios</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;15</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">7.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">timings</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Consitency-check">
<h2>Consitency check<a class="headerlink" href="#Consitency-check" title="Permalink to this headline">¶</a></h2>
<p>Ensure that every implementation delivers a consistent cluster result for test data sets.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the test data sets</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">generation_fxns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gen_circles</span><span class="p">,</span> <span class="n">gen_moons</span><span class="p">,</span> <span class="n">gen_varied</span><span class="p">,</span>
    <span class="n">gen_aniso</span><span class="p">,</span> <span class="n">gen_blobs</span><span class="p">,</span> <span class="n">gen_no_structure</span><span class="p">,</span>
    <span class="p">]</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">gen_fxn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">generation_fxns</span><span class="p">):</span>
    <span class="c1"># Plot</span>
    <span class="n">plot_data</span><span class="p">(</span><span class="n">gen_fxn</span><span class="p">(</span><span class="mi">5000</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">])</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="n">label</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "ca0fae9247d141c2bb371bd46631793f", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="section" id="scikit-learn-DBSCAN">
<h3>scikit-learn DBSCAN<a class="headerlink" href="#scikit-learn-DBSCAN" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the test data sets</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">generation_fxns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gen_circles</span><span class="p">,</span> <span class="n">gen_moons</span><span class="p">,</span> <span class="n">gen_varied</span><span class="p">,</span>
    <span class="n">gen_aniso</span><span class="p">,</span> <span class="n">gen_blobs</span><span class="p">,</span> <span class="n">gen_no_structure</span><span class="p">,</span>
    <span class="p">]</span>

<span class="n">fit_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>    <span class="c1"># circles</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>    <span class="c1"># moons</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>  <span class="c1"># varied</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.11</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>  <span class="c1"># aniso</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>    <span class="c1"># blobs</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>    <span class="c1"># no structure</span>
    <span class="p">]</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">gen_fxn</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">generation_fxns</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">)):</span>
    <span class="c1"># Fit</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">skcluster</span><span class="o">.</span><span class="n">dbscan</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Plot</span>
    <span class="n">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">noise</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="n">label</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f09abd68e90c4e46a8f4eed72bb8b18f", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
<div class="section" id="scikit-learn-extra-CommonNNClustering">
<h3>scikit-learn-extra CommonNNClustering<a class="headerlink" href="#scikit-learn-extra-CommonNNClustering" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the test data sets</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">generation_fxns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gen_circles</span><span class="p">,</span> <span class="n">gen_moons</span><span class="p">,</span> <span class="n">gen_varied</span><span class="p">,</span>
    <span class="n">gen_aniso</span><span class="p">,</span> <span class="n">gen_blobs</span><span class="p">,</span> <span class="n">gen_no_structure</span><span class="p">,</span>
    <span class="p">]</span>

<span class="n">fit_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>    <span class="c1"># circles</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>    <span class="c1"># moons</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">},</span>  <span class="c1"># varied</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>  <span class="c1"># aniso</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>    <span class="c1"># blobs</span>
    <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>    <span class="c1"># no structure</span>
    <span class="p">]</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">gen_fxn</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">generation_fxns</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">)):</span>
    <span class="c1"># Fit</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">skextracluster</span><span class="o">.</span><span class="n">commonnn</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">noise</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="n">label</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "5c0b8fc6d8c34676aac33084aeb839b5", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
<div class="section" id="cnnclustering-CNN-from-points-on-the-fly">
<h3>cnnclustering CNN from points on-the-fly<a class="headerlink" href="#cnnclustering-CNN-from-points-on-the-fly" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the test data sets</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">generation_fxns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gen_circles</span><span class="p">,</span> <span class="n">gen_moons</span><span class="p">,</span> <span class="n">gen_varied</span><span class="p">,</span>
    <span class="n">gen_aniso</span><span class="p">,</span> <span class="n">gen_blobs</span><span class="p">,</span> <span class="n">gen_no_structure</span><span class="p">,</span>
    <span class="p">]</span>

<span class="n">fit_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># circles</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># moons</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;member_cutoff&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span>  <span class="c1"># varied</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>                      <span class="c1"># aniso</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># blobs</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># no structure</span>
    <span class="p">]</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">gen_fxn</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">generation_fxns</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">)):</span>
    <span class="c1"># Fit</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
    <span class="n">clustering</span> <span class="o">=</span> <span class="n">cnn</span><span class="o">.</span><span class="n">CNN</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">policy</span><span class="o">=</span><span class="s2">&quot;conservative&quot;</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="n">label</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Execution time for call of fit: 0 hours, 0 minutes, 1.4432 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.200     5         2         None      2         0.500     0.001
--------------------------------------------------------------------------------
Execution time for call of fit: 0 hours, 0 minutes, 1.5315 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.200     5         2         None      2         0.500     0.000
--------------------------------------------------------------------------------
Execution time for call of fit: 0 hours, 0 minutes, 2.2066 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.180     20        8         None      3         0.337     0.135
--------------------------------------------------------------------------------
Execution time for call of fit: 0 hours, 0 minutes, 1.5084 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.150     10        2         None      3         0.326     0.028
--------------------------------------------------------------------------------
Execution time for call of fit: 0 hours, 0 minutes, 3.5528 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.200     5         2         None      3         0.333     0.000
--------------------------------------------------------------------------------
Execution time for call of fit: 0 hours, 0 minutes, 1.3277 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.200     5         2         None      1         1.000     0.000
--------------------------------------------------------------------------------
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "7a2ea8fd06cd423f98e1ca0b3456a2a6", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
<div class="section" id="cnnclustering-CNN-from-points-bulk">
<h3>cnnclustering CNN from points bulk<a class="headerlink" href="#cnnclustering-CNN-from-points-bulk" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the test data sets</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">generation_fxns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gen_circles</span><span class="p">,</span> <span class="n">gen_moons</span><span class="p">,</span> <span class="n">gen_varied</span><span class="p">,</span>
    <span class="n">gen_aniso</span><span class="p">,</span> <span class="n">gen_blobs</span><span class="p">,</span> <span class="n">gen_no_structure</span><span class="p">,</span>
    <span class="p">]</span>

<span class="n">fit_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># circles</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># moons</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;member_cutoff&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span>  <span class="c1"># varied</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>                      <span class="c1"># aniso</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># blobs</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># no structure</span>
    <span class="p">]</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">gen_fxn</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">generation_fxns</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">)):</span>
    <span class="c1"># Fit</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
    <span class="n">clustering</span> <span class="o">=</span> <span class="n">cnn</span><span class="o">.</span><span class="n">CNN</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">policy</span><span class="o">=</span><span class="s2">&quot;progressive&quot;</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="n">label</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Execution time for call of fit: 0 hours, 0 minutes, 0.1380 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.200     5         2         None      2         0.500     0.001
--------------------------------------------------------------------------------
Execution time for call of fit: 0 hours, 0 minutes, 0.1805 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.200     5         2         None      2         0.500     0.000
--------------------------------------------------------------------------------
Execution time for call of fit: 0 hours, 0 minutes, 0.4791 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.180     20        8         None      3         0.337     0.135
--------------------------------------------------------------------------------
Execution time for call of fit: 0 hours, 0 minutes, 0.2958 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.150     10        2         None      3         0.326     0.028
--------------------------------------------------------------------------------
Execution time for call of fit: 0 hours, 0 minutes, 1.1661 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.200     5         2         None      3         0.333     0.000
--------------------------------------------------------------------------------
Execution time for call of fit: 0 hours, 0 minutes, 0.1053 seconds
--------------------------------------------------------------------------------
#points   R         C         min       max       #clusters %largest  %noise
5000      0.200     5         2         None      1         1.000     0.000
--------------------------------------------------------------------------------
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "26443472cc81459a9ca1f77a0a4e8c5b", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
<div class="section" id="cnnclustering-CNN-from-distances-on-the-fly">
<h3>cnnclustering CNN from distances on-the-fly<a class="headerlink" href="#cnnclustering-CNN-from-distances-on-the-fly" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the test data sets</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">generation_fxns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gen_circles</span><span class="p">,</span> <span class="n">gen_moons</span><span class="p">,</span> <span class="n">gen_varied</span><span class="p">,</span>
    <span class="n">gen_aniso</span><span class="p">,</span> <span class="n">gen_blobs</span><span class="p">,</span> <span class="n">gen_no_structure</span><span class="p">,</span>
    <span class="p">]</span>

<span class="n">fit_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># circles</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># moons</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;member_cutoff&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span>  <span class="c1"># varied</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>                      <span class="c1"># aniso</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># blobs</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># no structure</span>
    <span class="p">]</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">gen_fxn</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">generation_fxns</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">)):</span>
    <span class="c1"># Fit</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
    <span class="n">clustering</span> <span class="o">=</span> <span class="n">cnn</span><span class="o">.</span><span class="n">CNN</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">calc_dist</span><span class="p">()</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">policy</span><span class="o">=</span><span class="s2">&quot;conservative&quot;</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="n">label</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "2569b625cf40467d86b3f5f6903d94ae", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
<div class="section" id="cnnclustering-CNN-from-distances-bulk">
<h3>cnnclustering CNN from distances bulk<a class="headerlink" href="#cnnclustering-CNN-from-distances-bulk" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the test data sets</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">generation_fxns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gen_circles</span><span class="p">,</span> <span class="n">gen_moons</span><span class="p">,</span> <span class="n">gen_varied</span><span class="p">,</span>
    <span class="n">gen_aniso</span><span class="p">,</span> <span class="n">gen_blobs</span><span class="p">,</span> <span class="n">gen_no_structure</span><span class="p">,</span>
    <span class="p">]</span>

<span class="n">fit_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># circles</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># moons</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;member_cutoff&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span>  <span class="c1"># varied</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>                      <span class="c1"># aniso</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># blobs</span>
    <span class="p">{</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;cnn_cutoff&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                        <span class="c1"># no structure</span>
    <span class="p">]</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">gen_fxn</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">generation_fxns</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">)):</span>
    <span class="c1"># Fit</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
    <span class="n">clustering</span> <span class="o">=</span> <span class="n">cnn</span><span class="o">.</span><span class="n">CNN</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">calc_dist</span><span class="p">()</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">policy</span><span class="o">=</span><span class="s2">&quot;progressive&quot;</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="n">label</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "737b1163f1344edf92102e225b1abf59", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
<div class="section" id="scikit-learn-OPTICS-(DBSCAN)">
<h3>scikit-learn OPTICS (DBSCAN)<a class="headerlink" href="#scikit-learn-OPTICS-(DBSCAN)" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the test data sets</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">generation_fxns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gen_circles</span><span class="p">,</span> <span class="n">gen_moons</span><span class="p">,</span> <span class="n">gen_varied</span><span class="p">,</span>
    <span class="n">gen_aniso</span><span class="p">,</span> <span class="n">gen_blobs</span><span class="p">,</span> <span class="n">gen_no_structure</span><span class="p">,</span>
    <span class="p">]</span>

<span class="n">fit_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;max_eps&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;cluster_method&quot;</span><span class="p">:</span> <span class="s2">&quot;dbscan&quot;</span><span class="p">},</span>    <span class="c1"># circles</span>
    <span class="p">{</span><span class="s2">&quot;max_eps&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;cluster_method&quot;</span><span class="p">:</span> <span class="s2">&quot;dbscan&quot;</span><span class="p">},</span>    <span class="c1"># moons</span>
    <span class="p">{</span><span class="s2">&quot;max_eps&quot;</span><span class="p">:</span> <span class="mf">0.125</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;cluster_method&quot;</span><span class="p">:</span> <span class="s2">&quot;dbscan&quot;</span><span class="p">},</span>   <span class="c1"># varied</span>
    <span class="p">{</span><span class="s2">&quot;max_eps&quot;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;cluster_method&quot;</span><span class="p">:</span> <span class="s2">&quot;dbscan&quot;</span><span class="p">},</span>   <span class="c1"># aniso</span>
    <span class="p">{</span><span class="s2">&quot;max_eps&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;cluster_method&quot;</span><span class="p">:</span> <span class="s2">&quot;dbscan&quot;</span><span class="p">},</span>    <span class="c1"># blobs</span>
    <span class="p">{</span><span class="s2">&quot;max_eps&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;cluster_method&quot;</span><span class="p">:</span> <span class="s2">&quot;dbscan&quot;</span><span class="p">},</span>    <span class="c1"># no structure</span>
    <span class="p">]</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">gen_fxn</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">generation_fxns</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">)):</span>
    <span class="c1"># Fit</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
    <span class="n">clustering</span> <span class="o">=</span> <span class="n">skcluster</span><span class="o">.</span><span class="n">OPTICS</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">noise</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="n">label</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "408fcdce575d42ed9c5dcd0f82a58f29", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
<div class="section" id="scikit-learn-OPTICS-(XI)">
<h3>scikit-learn OPTICS (XI)<a class="headerlink" href="#scikit-learn-OPTICS-(XI)" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Plot the test data sets</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">generation_fxns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">gen_circles</span><span class="p">,</span> <span class="n">gen_moons</span><span class="p">,</span> <span class="n">gen_varied</span><span class="p">,</span>
    <span class="n">gen_aniso</span><span class="p">,</span> <span class="n">gen_blobs</span><span class="p">,</span> <span class="n">gen_no_structure</span><span class="p">,</span>
    <span class="p">]</span>

<span class="n">fit_params</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">},</span>    <span class="c1"># circles</span>
    <span class="p">{</span><span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">},</span>    <span class="c1"># moons</span>
    <span class="p">{</span><span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">},</span>   <span class="c1"># varied</span>
    <span class="p">{</span><span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">,</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span>   <span class="c1"># aniso</span>
    <span class="p">{</span><span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>    <span class="c1"># blobs</span>
    <span class="p">{</span><span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;xi&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;min_cluster_size&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">},</span>    <span class="c1"># no structure</span>
    <span class="p">]</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">gen_fxn</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">generation_fxns</span><span class="p">,</span> <span class="n">fit_params</span><span class="p">)):</span>
    <span class="c1"># Fit</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
    <span class="n">clustering</span> <span class="o">=</span> <span class="n">skcluster</span><span class="o">.</span><span class="n">OPTICS</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Plot</span>
    <span class="n">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">clustering</span><span class="o">.</span><span class="n">labels_</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">noise</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="n">label</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">gen_fxn</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "74c7776f092b4c769fc9248c113c336c", "version_major": 2, "version_minor": 0}</script></div>
</div>
</div>
</div>
<div class="section" id="Timings">
<h2>Timings<a class="headerlink" href="#Timings" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Blobs-set">
<h3>Blobs set<a class="headerlink" href="#Blobs-set" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">benchmark_signatures</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;DBSCAN&quot;</span><span class="p">,</span> <span class="n">skcluster</span><span class="o">.</span><span class="n">dbscan</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DS_ATTR:points&quot;</span><span class="p">,</span> <span class="p">),</span> <span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}}),</span>
    <span class="p">(</span><span class="s2">&quot;CommonNN&quot;</span><span class="p">,</span> <span class="n">skextracluster</span><span class="o">.</span><span class="n">commonnn</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DS_ATTR:points&quot;</span><span class="p">,</span> <span class="p">),</span> <span class="p">{</span><span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;eps&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;min_samples&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}}),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># TIMINGS = {}</span>
<span class="n">TIMINGS</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">time_runs</span><span class="p">(</span><span class="n">benchmark_signatures</span><span class="p">,</span> <span class="n">gen_blobs</span><span class="p">,</span> <span class="n">samples</span><span class="o">=</span><span class="p">[</span><span class="mi">20000</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--------------------------------------------------------------------------------
20000
         DBSCAN:   1.000
       CommonNN:  16.444
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">TIMINGS</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;DBSCAN&quot;</span><span class="p">,</span> <span class="s2">&quot;CommonNN&quot;</span><span class="p">]:</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
        <span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">average</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">TIMINGS</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">])</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "147f05c641b74751845a612e290541cf", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[80]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[200, 0.001104492306285725],
 [2000, 0.0010950690424282844],
 [5000, 0.0010891374409994958]]
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Fit-variants">
<h2>Fit variants<a class="headerlink" href="#Fit-variants" title="Permalink to this headline">¶</a></h2>
<p>Benchmarks for different approaches to the common-nearest-neighbours fit function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Benchmark results will be saved under:</span>
<span class="n">report_dir</span> <span class="o">=</span> <span class="s2">&quot;reports/T460&quot;</span>
<span class="c1"># report_dir = &quot;reports/qcw21&quot;</span>
<span class="c1"># report_dir = &quot;reports/qcm07&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="From-neighbours">
<h3>From neighbours<a class="headerlink" href="#From-neighbours" title="Permalink to this headline">¶</a></h3>
<p>Tests of fit functions taking pre-computed neighbourhoods as input. Two ways of setting up the benchmarks are provided: - Use <code class="docutils literal notranslate"><span class="pre">prepare_neighbours</span></code> function to quickly generate the input data - Use <code class="docutils literal notranslate"><span class="pre">DS</span></code> benchmark class to organise different runs on essentially the same data set</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">DS</span><span class="p">(</span><span class="n">gen_circles</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="From-list-of-sets">
<h4>From list of sets<a class="headerlink" href="#From-list-of-sets" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Prepare neighbours as list of sets</span>
<span class="n">ds</span><span class="o">.</span><span class="n">prepare_neighbourhoods</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
circles_2000_n0.5
</pre></div></div>
</div>
<div class="section" id="Baseline">
<h5>Baseline<a class="headerlink" href="#Baseline" title="Permalink to this headline">¶</a></h5>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[110]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using original implementation</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">fit_from_neighbours_baseline</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of labels:    2000
Noise:               0
Largest:             1000
Clusters:            2

*** Profile printout saved to text file &#39;reports/T460/fit_from_neighbours_baseline_circles_2000_n0.5.lprun&#39;.
256 ms ± 5.51 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div></div>
</div>
</div>
<div class="section" id="Stdlib-index">
<h5>Stdlib index<a class="headerlink" href="#Stdlib-index" title="Permalink to this headline">¶</a></h5>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">fit_stdlib_from_neighbours_index</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">)),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "119ea1be4fe1431290aa01daefc904aa", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using only standard library</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">fit_stdlib_from_neighbours_index</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;std_index&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of labels:    2000
Noise:               0
Largest:             1000
Clusters:            2

*** Profile printout saved to text file &#39;reports/T460/fit_stdlib_from_neighbours_index_circles_2000_n0.5.lprun&#39;.
36.3 ms ± 88 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[111]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">fit_stdlib_from_neighbours_loop</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">)),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "37342e9248a54c9790490b54608d2300", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[113]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using only standard library</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">fit_stdlib_from_neighbours_loop</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;std_loop&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of labels:    2000
Noise:               0
Largest:             1000
Clusters:            2

*** Profile printout saved to text file &#39;reports/T460/fit_stdlib_from_neighbours_loop_circles_2000_n0.5.lprun&#39;.
40 ms ± 511 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[114]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">fit_stdlib_from_neighbours_loop_membercheck</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">)),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9e84d8619ff243778e46f17695456c71", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[115]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using only standard library</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">fit_stdlib_from_neighbours_loop_membercheck</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;std_loop_membercheck&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of labels:    2000
Noise:               0
Largest:             1000
Clusters:            2

*** Profile printout saved to text file &#39;reports/T460/fit_stdlib_from_neighbours_loop_membercheck_circles_2000_n0.5.lprun&#39;.
41.8 ms ± 3.99 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
</div>
<div class="section" id="Stdlib-cython">
<h5>Stdlib cython<a class="headerlink" href="#Stdlib-cython" title="Permalink to this headline">¶</a></h5>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">_cfits</span><span class="o">.</span><span class="n">fit_from_neighbours</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">)),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b15c65fe167740c9afdc269b14d9dfb5", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using only standard library</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">_cfits</span><span class="o">.</span><span class="n">fit_from_neighbours</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;std_cython&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of labels:    2000
Noise:               0
Largest:             1000
Clusters:            2
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-31-14cc7f3c97a4&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">      1</span> <span class="ansi-red-intense-fg ansi-bold"># Implementation using only standard library</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 2</span><span class="ansi-yellow-intense-fg ansi-bold"> profile_fxn(
</span><span class="ansi-green-fg">      3</span>     _cfits<span class="ansi-yellow-intense-fg ansi-bold">.</span>fit_from_neighbours<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">      4</span>     ds<span class="ansi-yellow-intense-fg ansi-bold">,</span> report_dir<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">      5</span>     <span class="ansi-cyan-intense-fg ansi-bold">20</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> ds<span class="ansi-yellow-intense-fg ansi-bold">.</span>neighbourhoods<span class="ansi-yellow-intense-fg ansi-bold">,</span>  <span class="ansi-red-intense-fg ansi-bold"># function args</span>

<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-22-1405b8a32e8f&gt;</span> in <span class="ansi-cyan-fg">profile_fxn</span><span class="ansi-blue-intense-fg ansi-bold">(f, ds, report_dir, t, l, m, label, *args, **kwargs)</span>
<span class="ansi-green-fg">     68</span>     <span class="ansi-red-intense-fg ansi-bold"># Profile</span>
<span class="ansi-green-fg">     69</span>     <span class="ansi-green-intense-fg ansi-bold">if</span> l<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">---&gt; 70</span><span class="ansi-yellow-intense-fg ansi-bold">         </span>get_ipython<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>run_line_magic<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;lprun&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;-T {report_dir}/{fxn.__name__}_{ds.__str__()}.lprun -f fxn fxn(*fxn_args, **fxn_kwargs)&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     71</span>     <span class="ansi-green-intense-fg ansi-bold">if</span> t<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">     72</span>         o <span class="ansi-yellow-intense-fg ansi-bold">=</span> get_ipython<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>run_line_magic<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#39;timeit&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-blue-intense-fg ansi-bold">&#39;-o fxn(*fxn_args, **fxn_kwargs)&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">~/.local/share/virtualenvs/CNN-5gkgQAOT/lib/python3.8/site-packages/IPython/core/interactiveshell.py</span> in <span class="ansi-cyan-fg">run_line_magic</span><span class="ansi-blue-intense-fg ansi-bold">(self, magic_name, line, _stack_depth)</span>
<span class="ansi-green-fg">   2315</span>                 kwargs<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;local_ns&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">=</span> sys<span class="ansi-yellow-intense-fg ansi-bold">.</span>_getframe<span class="ansi-yellow-intense-fg ansi-bold">(</span>stack_depth<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">.</span>f_locals
<span class="ansi-green-fg">   2316</span>             <span class="ansi-green-intense-fg ansi-bold">with</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>builtin_trap<span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">-&gt; 2317</span><span class="ansi-yellow-intense-fg ansi-bold">                 </span>result <span class="ansi-yellow-intense-fg ansi-bold">=</span> fn<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">*</span>args<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">   2318</span>             <span class="ansi-green-intense-fg ansi-bold">return</span> result
<span class="ansi-green-fg">   2319</span>

<span class="ansi-green-intense-fg ansi-bold">&lt;decorator-gen-129&gt;</span> in <span class="ansi-cyan-fg">lprun</span><span class="ansi-blue-intense-fg ansi-bold">(self, parameter_s)</span>

<span class="ansi-green-intense-fg ansi-bold">~/.local/share/virtualenvs/CNN-5gkgQAOT/lib/python3.8/site-packages/IPython/core/magic.py</span> in <span class="ansi-cyan-fg">&lt;lambda&gt;</span><span class="ansi-blue-intense-fg ansi-bold">(f, *a, **k)</span>
<span class="ansi-green-fg">    185</span>     <span class="ansi-red-intense-fg ansi-bold"># but it&#39;s overkill for just that one bit of state.</span>
<span class="ansi-green-fg">    186</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> magic_deco<span class="ansi-yellow-intense-fg ansi-bold">(</span>arg<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 187</span><span class="ansi-yellow-intense-fg ansi-bold">         </span>call <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-green-intense-fg ansi-bold">lambda</span> f<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">*</span>a<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>k<span class="ansi-yellow-intense-fg ansi-bold">:</span> f<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">*</span>a<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>k<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    188</span>
<span class="ansi-green-fg">    189</span>         <span class="ansi-green-intense-fg ansi-bold">if</span> callable<span class="ansi-yellow-intense-fg ansi-bold">(</span>arg<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-intense-fg ansi-bold">~/.local/share/virtualenvs/CNN-5gkgQAOT/lib/python3.8/site-packages/line_profiler/line_profiler.py</span> in <span class="ansi-cyan-fg">lprun</span><span class="ansi-blue-intense-fg ansi-bold">(self, parameter_s)</span>
<span class="ansi-green-fg">    374</span>         <span class="ansi-red-intense-fg ansi-bold"># Trap text output.</span>
<span class="ansi-green-fg">    375</span>         stdout_trap <span class="ansi-yellow-intense-fg ansi-bold">=</span> StringIO<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 376</span><span class="ansi-yellow-intense-fg ansi-bold">         </span>profile<span class="ansi-yellow-intense-fg ansi-bold">.</span>print_stats<span class="ansi-yellow-intense-fg ansi-bold">(</span>stdout_trap<span class="ansi-yellow-intense-fg ansi-bold">,</span> output_unit<span class="ansi-yellow-intense-fg ansi-bold">=</span>output_unit<span class="ansi-yellow-intense-fg ansi-bold">,</span> stripzeros<span class="ansi-yellow-intense-fg ansi-bold">=</span><span class="ansi-blue-intense-fg ansi-bold">&#39;s&#39;</span> <span class="ansi-green-intense-fg ansi-bold">in</span> opts<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    377</span>         output <span class="ansi-yellow-intense-fg ansi-bold">=</span> stdout_trap<span class="ansi-yellow-intense-fg ansi-bold">.</span>getvalue<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    378</span>         output <span class="ansi-yellow-intense-fg ansi-bold">=</span> output<span class="ansi-yellow-intense-fg ansi-bold">.</span>rstrip<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>

<span class="ansi-green-intense-fg ansi-bold">~/.local/share/virtualenvs/CNN-5gkgQAOT/lib/python3.8/site-packages/line_profiler/line_profiler.py</span> in <span class="ansi-cyan-fg">print_stats</span><span class="ansi-blue-intense-fg ansi-bold">(self, stream, output_unit, stripzeros)</span>
<span class="ansi-green-fg">    142</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">    143</span>         lstats <span class="ansi-yellow-intense-fg ansi-bold">=</span> self<span class="ansi-yellow-intense-fg ansi-bold">.</span>get_stats<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 144</span><span class="ansi-yellow-intense-fg ansi-bold">         </span>show_text<span class="ansi-yellow-intense-fg ansi-bold">(</span>lstats<span class="ansi-yellow-intense-fg ansi-bold">.</span>timings<span class="ansi-yellow-intense-fg ansi-bold">,</span> lstats<span class="ansi-yellow-intense-fg ansi-bold">.</span>unit<span class="ansi-yellow-intense-fg ansi-bold">,</span> output_unit<span class="ansi-yellow-intense-fg ansi-bold">=</span>output_unit<span class="ansi-yellow-intense-fg ansi-bold">,</span> stream<span class="ansi-yellow-intense-fg ansi-bold">=</span>stream<span class="ansi-yellow-intense-fg ansi-bold">,</span> stripzeros<span class="ansi-yellow-intense-fg ansi-bold">=</span>stripzeros<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    145</span>
<span class="ansi-green-fg">    146</span>     <span class="ansi-green-intense-fg ansi-bold">def</span> run<span class="ansi-yellow-intense-fg ansi-bold">(</span>self<span class="ansi-yellow-intense-fg ansi-bold">,</span> cmd<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-green-intense-fg ansi-bold">~/.local/share/virtualenvs/CNN-5gkgQAOT/lib/python3.8/site-packages/line_profiler/line_profiler.py</span> in <span class="ansi-cyan-fg">show_text</span><span class="ansi-blue-intense-fg ansi-bold">(stats, unit, output_unit, stream, stripzeros)</span>
<span class="ansi-green-fg">    263</span>
<span class="ansi-green-fg">    264</span>     <span class="ansi-green-intense-fg ansi-bold">for</span> <span class="ansi-yellow-intense-fg ansi-bold">(</span>fn<span class="ansi-yellow-intense-fg ansi-bold">,</span> lineno<span class="ansi-yellow-intense-fg ansi-bold">,</span> name<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> timings <span class="ansi-green-intense-fg ansi-bold">in</span> sorted<span class="ansi-yellow-intense-fg ansi-bold">(</span>stats<span class="ansi-yellow-intense-fg ansi-bold">.</span>items<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 265</span><span class="ansi-yellow-intense-fg ansi-bold">         show_func(fn, lineno, name, stats[fn, lineno, name], unit,
</span><span class="ansi-green-fg">    266</span>             output_unit=output_unit, stream=stream, stripzeros=stripzeros)
<span class="ansi-green-fg">    267</span>

<span class="ansi-green-intense-fg ansi-bold">~/.local/share/virtualenvs/CNN-5gkgQAOT/lib/python3.8/site-packages/line_profiler/line_profiler.py</span> in <span class="ansi-cyan-fg">show_func</span><span class="ansi-blue-intense-fg ansi-bold">(filename, start_lineno, func_name, timings, unit, output_unit, stream, stripzeros)</span>
<span class="ansi-green-fg">    227</span>         stream<span class="ansi-yellow-intense-fg ansi-bold">.</span>write<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-blue-intense-fg ansi-bold">&#34;Continuing without the function&#39;s contents.\n&#34;</span><span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">    228</span>         <span class="ansi-red-intense-fg ansi-bold"># Fake empty lines so we can see the timings, if not the code.</span>
<span class="ansi-green-intense-fg ansi-bold">--&gt; 229</span><span class="ansi-yellow-intense-fg ansi-bold">         </span>nlines <span class="ansi-yellow-intense-fg ansi-bold">=</span> max<span class="ansi-yellow-intense-fg ansi-bold">(</span>linenos<span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-yellow-intense-fg ansi-bold">-</span> min<span class="ansi-yellow-intense-fg ansi-bold">(</span>min<span class="ansi-yellow-intense-fg ansi-bold">(</span>linenos<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> start_lineno<span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-yellow-intense-fg ansi-bold">+</span> <span class="ansi-cyan-intense-fg ansi-bold">1</span>
<span class="ansi-green-fg">    230</span>         sublines <span class="ansi-yellow-intense-fg ansi-bold">=</span> <span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-blue-intense-fg ansi-bold">&#39;&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">]</span> <span class="ansi-yellow-intense-fg ansi-bold">*</span> nlines
<span class="ansi-green-fg">    231</span>     <span class="ansi-green-intense-fg ansi-bold">for</span> lineno<span class="ansi-yellow-intense-fg ansi-bold">,</span> nhits<span class="ansi-yellow-intense-fg ansi-bold">,</span> time <span class="ansi-green-intense-fg ansi-bold">in</span> timings<span class="ansi-yellow-intense-fg ansi-bold">:</span>

<span class="ansi-red-intense-fg ansi-bold">ValueError</span>: max() arg is an empty sequence
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">timeit</span> _cfits.fit_from_neighbours(20, ds.neighbourhoods)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
25.8 ms ± 541 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="From-numpy.array">
<h4>From numpy.array<a class="headerlink" href="#From-numpy.array" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[136]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">fits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[136]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;module &#39;snippets.fits&#39; from &#39;/home/janjoswig/CNN/tests/benchmark/snippets/fits.py&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[118]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Switch to neighbourhoods as numpy.array of numpy.arrays</span>
<span class="n">ds</span><span class="o">.</span><span class="n">prepare_neighbours</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[142]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">baseline_to_labels</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">fit_from_neighbours_baseline</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">)),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "1d986c8eff4b40288ec76bc65e64b913", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[140]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using original implementation</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">fit_from_neighbours_baseline</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;baseline&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of labels:    2000
Noise:               0
Largest:             1000
Clusters:            2

*** Profile printout saved to text file &#39;reports/T460/fit_from_neighbours_baseline_circles_2000_n0.5.lprun&#39;.
368 ms ± 57.9 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[137]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">fit_numpy_mix</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "77b1d640f4734322a1545d44a18aedf3", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[143]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using numpy</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">fit_numpy_mix</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;numpy_index&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of labels:    2000
Noise:               0
Largest:             1000
Clusters:            2

*** Profile printout saved to text file &#39;reports/T460/fit_numpy_mix_circles_2000_n0.5.lprun&#39;.
146 ms ± 1.58 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[119]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">fit_numpy_from_neighbours_index</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">)),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d31e7529f6ea43179ee5343718778ead", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[139]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using numpy</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">fit_numpy_from_neighbours_index</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;numpy_index&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of labels:    2000
Noise:               0
Largest:             1000
Clusters:            2

*** Profile printout saved to text file &#39;reports/T460/fit_numpy_from_neighbours_index_circles_2000_n0.5.lprun&#39;.
103 ms ± 19.6 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[121]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">fit_numpy_from_neighbours_loop</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">)),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "060cd7d76eec415d8206fc8d8cd883c9", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[123]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using numpy</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">fit_numpy_from_neighbours_loop</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;numpy_loop&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of labels:    2000
Noise:               0
Largest:             1000
Clusters:            2

*** Profile printout saved to text file &#39;reports/T460/fit_numpy_from_neighbours_loop_circles_2000_n0.5.lprun&#39;.
96.9 ms ± 2.24 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[124]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">fit_numpy_from_neighbours_filtermembers</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">)),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "646a4ca25ef1436a95b77c8503d1b2c1", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[130]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using numpy</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">fit_numpy_from_neighbours_filtermembers</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;numpy_filter&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of labels:    2000
Noise:               0
Largest:             1000
Clusters:            2

*** Profile printout saved to text file &#39;reports/T460/fit_numpy_from_neighbours_filtermembers_circles_2000_n0.5.lprun&#39;.
43.8 ms ± 965 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[132]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">fits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[132]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;module &#39;snippets.fits&#39; from &#39;/home/janjoswig/CNN/tests/benchmark/snippets/fits.py&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[129]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plot_data</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">points</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">fit_numpy_from_neighbours_membercheck</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">)),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "dc91ed8c4c8b408eb8185bb08e4b8ca4", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[131]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using numpy</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">fits</span><span class="o">.</span><span class="n">fit_numpy_from_neighbours_membercheck</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">20</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;numpy_filter&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of labels:    2000
Noise:               0
Largest:             1000
Clusters:            2

*** Profile printout saved to text file &#39;reports/T460/fit_numpy_from_neighbours_membercheck_circles_2000_n0.5.lprun&#39;.
46.7 ms ± 4.34 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Implementation using cythonised numpy</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">cfits</span><span class="o">.</span><span class="n">cfit_from_neighbours</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mi">1</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">neighbours</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;cython_numpy_loop&quot;</span><span class="p">,</span>
    <span class="n">l</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-73-d8c72077d3b4&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">      1</span> <span class="ansi-red-intense-fg ansi-bold"># Implementation using cythonised numpy</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 2</span><span class="ansi-yellow-intense-fg ansi-bold"> profile_fxn(
</span><span class="ansi-green-fg">      3</span>     cfits<span class="ansi-yellow-intense-fg ansi-bold">.</span>cfit_from_neighbours<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">      4</span>     ds<span class="ansi-yellow-intense-fg ansi-bold">,</span> report_dir<span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">      5</span>     <span class="ansi-cyan-intense-fg ansi-bold">1</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> ds<span class="ansi-yellow-intense-fg ansi-bold">.</span>neighbours<span class="ansi-yellow-intense-fg ansi-bold">,</span>  <span class="ansi-red-intense-fg ansi-bold"># function args</span>

<span class="ansi-green-intense-fg ansi-bold">&lt;ipython-input-65-3b108bdce0ce&gt;</span> in <span class="ansi-cyan-fg">profile_fxn</span><span class="ansi-blue-intense-fg ansi-bold">(f, ds, report_dir, t, l, m, label, *args, **kwargs)</span>
<span class="ansi-green-fg">     44</span>
<span class="ansi-green-fg">     45</span>     <span class="ansi-red-intense-fg ansi-bold"># Validate function result</span>
<span class="ansi-green-intense-fg ansi-bold">---&gt; 46</span><span class="ansi-yellow-intense-fg ansi-bold">     </span>result <span class="ansi-yellow-intense-fg ansi-bold">=</span> fxn<span class="ansi-yellow-intense-fg ansi-bold">(</span><span class="ansi-yellow-intense-fg ansi-bold">*</span>fxn_args<span class="ansi-yellow-intense-fg ansi-bold">,</span> <span class="ansi-yellow-intense-fg ansi-bold">**</span>fxn_kwargs<span class="ansi-yellow-intense-fg ansi-bold">)</span>
<span class="ansi-green-fg">     47</span>     <span class="ansi-green-intense-fg ansi-bold">if</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>result<span class="ansi-yellow-intense-fg ansi-bold">,</span> list<span class="ansi-yellow-intense-fg ansi-bold">)</span> <span class="ansi-green-intense-fg ansi-bold">and</span> isinstance<span class="ansi-yellow-intense-fg ansi-bold">(</span>result<span class="ansi-yellow-intense-fg ansi-bold">[</span><span class="ansi-cyan-intense-fg ansi-bold">0</span><span class="ansi-yellow-intense-fg ansi-bold">]</span><span class="ansi-yellow-intense-fg ansi-bold">,</span> np<span class="ansi-yellow-intense-fg ansi-bold">.</span>ndarray<span class="ansi-yellow-intense-fg ansi-bold">)</span><span class="ansi-yellow-intense-fg ansi-bold">:</span>
<span class="ansi-green-fg">     48</span>         <span class="ansi-red-intense-fg ansi-bold"># Convert result if from original implementation</span>

<span class="ansi-green-intense-fg ansi-bold">~/CNN/tests/benchmark/snippets/cfits.pyx</span> in <span class="ansi-cyan-fg">cfits.cfit_from_neighbours</span><span class="ansi-blue-intense-fg ansi-bold">()</span>

<span class="ansi-red-intense-fg ansi-bold">ValueError</span>: Buffer dtype mismatch, expected &#39;npy_intp&#39; but got &#39;double&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">ratios</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">&gt;15</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">7.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
        std_cnn:   1.000
</pre></div></div>
</div>
</div>
<div class="section" id="Check-in-CNN-class-context">
<h4>Check in CNN class context<a class="headerlink" href="#Check-in-CNN-class-context" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cobj</span> <span class="o">=</span> <span class="n">cnn</span><span class="o">.</span><span class="n">CNN</span><span class="p">(</span><span class="n">neighbourhoods</span><span class="o">=</span><span class="n">cnn</span><span class="o">.</span><span class="n">NeighbourhoodsList</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">profile_fxn</span><span class="p">(</span>
    <span class="n">cobj</span><span class="o">.</span><span class="n">fit</span><span class="p">,</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">report_dir</span><span class="p">,</span>
    <span class="mf">0.5</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span>  <span class="c1"># function args</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;std_cnn&quot;</span><span class="p">,</span>
    <span class="n">rec</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

*** Profile printout saved to text file &#39;reports/T460/fit_circles_2000_n0.5.lprun&#39;.
31.7 ms ± 447 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cobj</span><span class="o">.</span><span class="n">labels</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Labels([1, 2, 2, ..., 1, 2, 2])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">cfits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;module &#39;cfits&#39; from &#39;/home/janjoswig/CNN/cfits.cpython-38-x86_64-linux-gnu.so&#39;&gt;
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="From-density-graph">
<h3>From density graph<a class="headerlink" href="#From-density-graph" title="Permalink to this headline">¶</a></h3>
<div class="section" id="From-SparsegraphArray">
<h4>From SparsegraphArray<a class="headerlink" href="#From-SparsegraphArray" title="Permalink to this headline">¶</a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">cnn</span><span class="p">)</span>
<span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">_cfits</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;module &#39;core._cfits&#39; from &#39;/home/janjoswig/CNN/core/_cfits.cpython-38-x86_64-linux-gnu.so&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Graph</span> <span class="o">=</span> <span class="n">cnn</span><span class="o">.</span><span class="n">SparsegraphArray</span><span class="p">(</span><span class="o">*</span><span class="n">_cfits</span><span class="o">.</span><span class="n">NeighbourhoodsList2SparsegraphArray</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">neighbourhoods</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Graph</span><span class="o">.</span><span class="n">_indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
2001
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">timeit</span> labels = cnn.Labels(_cfits.bfs_SparsegraphArray(Graph, Graph._indices))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
417 µs ± 9.54 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">labels</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Labels([1, 2, 2, ..., 1, 2, 2])
</pre></div></div>
</div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">cnnclustering</a></h1>



<p class="blurb">CNN clustering and csMSM estimation in Python</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=janjoswig&repo=CNN&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_source/install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_source/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_source/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_source/api_reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Jan-Oliver Joswig.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/benchmark/bm.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>