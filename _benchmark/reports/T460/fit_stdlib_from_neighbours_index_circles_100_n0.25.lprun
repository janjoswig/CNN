Timer unit: 1e-06 s

Total time: 0.002131 s
File: /home/janjoswig/CNN/tests/benchmark/snippets/fits.py
Function: fit_stdlib_from_neighbours_index at line 154

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   154                                           def fit_stdlib_from_neighbours_index(
   155                                                   cnn_cutoff: int,
   156                                                   neighbours: List[Set[int]]) -> List:
   157                                               """Worker function variant applying the CNN algorithm.
   158                                           
   159                                               Assigns labels to points starting from pre-computed neighbour list.
   160                                               Uses Python standard library only.  Uses builtin function `index`
   161                                               to find unassigned initial cluster points, which is expected to be
   162                                               fast when done seldom (compare to fit_stdlib_from_neighbours_loop).
   163                                           
   164                                               Args:
   165                                                   cnn_cutoff: Similarity criterion
   166                                                   neighbours: List of length #points containing sets of
   167                                                       neighbouring point indices
   168                                           
   169                                               Returns:
   170                                                   Labels
   171                                               """
   172                                           
   173                                               # Initialise labels
   174         1         27.0     27.0      1.3      labels = [0 for _ in range(len(neighbours))]
   175                                           
   176                                               # Track assigment
   177         1         21.0     21.0      1.0      include = [True for _ in range(len(neighbours))]
   178                                           
   179                                               # Start with first cluster (0 = noise)
   180         1          2.0      2.0      0.1      current = 1
   181                                           
   182                                               # Initialise queue of points to scan
   183         1          2.0      2.0      0.1      queue = deque()
   184                                           
   185                                               while True:
   186        64         79.0      1.2      3.7          try:
   187        64        144.0      2.2      6.8              point = include.index(True)  # Pick starting point
   188         1          2.0      2.0      0.1          except ValueError:               # All points assigned
   189         1          2.0      2.0      0.1              break
   190        63         76.0      1.2      3.6          labels[point] = current          # Assign cluster label
   191        63         76.0      1.2      3.6          include[point] = False           # Mark point as included
   192        63         88.0      1.4      4.1          queue.append(point)              # Add point to queue
   193                                           
   194       163        191.0      1.2      9.0          while queue:
   195       100        128.0      1.3      6.0              point = queue.popleft()      # FIFO
   196                                           
   197                                                       # Loop over neighbouring points
   198       100        147.0      1.5      6.9              neigh = neighbours[point]
   199       298        363.0      1.2     17.0              for member in neigh:
   200       198        242.0      1.2     11.4                  if not include[member]:
   201                                                               # Point already assigned
   202       132        147.0      1.1      6.9                      continue
   203                                           
   204                                                           # conditional growth
   205        66        161.0      2.4      7.6                  if len(neigh.intersection(neighbours[member])) >= cnn_cutoff:
   206        37         51.0      1.4      2.4                      labels[member] = current
   207        37         50.0      1.4      2.3                      include[member] = False
   208        37         56.0      1.5      2.6                      queue.append(member)
   209                                           
   210        63         75.0      1.2      3.5          current += 1
   211                                           
   212         1          1.0      1.0      0.0      return labels