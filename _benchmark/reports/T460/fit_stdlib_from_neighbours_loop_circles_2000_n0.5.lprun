Timer unit: 1e-06 s

Total time: 0.709991 s
File: /home/janjoswig/CNN/tests/benchmark/snippets/fits.py
Function: fit_stdlib_from_neighbours_loop at line 215

Line #      Hits         Time  Per Hit   % Time  Line Contents
==============================================================
   215                                           def fit_stdlib_from_neighbours_loop(
   216                                                   cnn_cutoff: int,
   217                                                   neighbours: List[Set[int]]) -> List:
   218                                               """Worker function variant applying the CNN algorithm.
   219                                           
   220                                               Assigns labels to points starting from pre-computed neighbour list.
   221                                               Uses Python standard library only.  Minor design difference to
   222                                               `fit_stdlib_from_neighbours_index` in looping over all points
   223                                               instead of checking for `consider.index(True)`. Expected to be faster
   224                                               when many cluster initialisations are done. Also, checking queue
   225                                               at the end of the inner loop instead of in the begenning (no
   226                                               performance difference expected, but unnecessary adding of initial
   227                                               points to queue is avoided).
   228                                           
   229                                               Args:
   230                                                   cnn_cutoff: Similarity criterion
   231                                                   neighbours: List of length #points containing sets of
   232                                                       neighbouring point indices
   233                                           
   234                                               Returns:
   235                                                   Labels
   236                                               """
   237                                           
   238         1          3.0      3.0      0.0      len_ = len(neighbours)
   239                                           
   240                                               # Initialise labels
   241         1        224.0    224.0      0.0      labels = [0 for _ in range(len_)]
   242                                           
   243                                               # Track assigment
   244         1        340.0    340.0      0.0      consider = [True for _ in range(len_)]
   245                                           
   246                                               # Start with first cluster (0 = noise)
   247         1          2.0      2.0      0.0      current = 1
   248                                           
   249                                               # Initialise queue of points to scan
   250         1          3.0      3.0      0.0      queue = deque()
   251                                           
   252      2001       1327.0      0.7      0.2      for point in range(len_):
   253      2000       1356.0      0.7      0.2          if not consider[point]:
   254                                                       # Point already assigned
   255      1998       1298.0      0.6      0.2              continue
   256         2          4.0      2.0      0.0          labels[point] = current          # Assign cluster label
   257         2          2.0      1.0      0.0          consider[point] = False           # Mark point as included
   258                                           
   259                                                   while True:
   260                                                       # Loop over neighbouring points
   261      2000       2632.0      1.3      0.4              neigh = neighbours[point]
   262    262204     228297.0      0.9     32.2              for member in neigh:
   263    260204     232205.0      0.9     32.7                  if not consider[member]:
   264                                                               # Point already assigned
   265    258170     201703.0      0.8     28.4                      continue
   266                                           
   267                                                           # conditional growth
   268      2034      29046.0     14.3      4.1                  if len(neigh.intersection(neighbours[member])) >= cnn_cutoff:
   269      1998       2773.0      1.4      0.4                      labels[member] = current
   270      1998       1875.0      0.9      0.3                      consider[member] = False
   271      1998       2412.0      1.2      0.3                      queue.append(member)
   272                                           
   273      2000       1746.0      0.9      0.2              if not queue:
   274         2          2.0      1.0      0.0                  break
   275      1998       2737.0      1.4      0.4              point = queue.popleft()  # FIFO
   276                                           
   277         2          3.0      1.5      0.0          current += 1
   278                                           
   279         1          1.0      1.0      0.0      return labels